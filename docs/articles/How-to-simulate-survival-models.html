<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to simulate datasets from different survival models • survMS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to simulate datasets from different survival models">
<meta property="og:description" content="survMS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survMS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/index.html">
    <span class="fa fa-book"></span>
     
    Articles
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-code"></span>
     
    Functions Documentation
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mathildesautreuil/survMS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to simulate datasets from different survival models</h1>
            
      
      
      <div class="hidden name"><code>How-to-simulate-survival-models.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">survMS</span><span class="op">)</span>
<span class="co">#&gt; Le chargement a nécessité le package : ggplot2</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1 Introduction</h1>
<p>This package enables us to simulate survival data with several levels of complexity from different survival models: Cox model <span class="citation">(Cox 1972)</span>, the Accelerated Failure Time (AFT) model, and the Accelerated Hazard (AH) model <span class="citation">(Chen and Wang 2000)</span>. To simulate data from a Cox model, we consider the procedure of <span class="citation">(Bender, Augustin, and Blettner 2005)</span>. This model is the most popular in survival analysis, but other models exist. The package also enables us to simulate survival data from an AFT model based on <span class="citation">(Leemis, Shih, and Reynertson 1990)</span>. Considering different models for data simulation is interesting because the assumptions associated with these models are different. Indeed, the Cox model is a proportional risk model, not the AFT model. In the AFT model, the variables will have an accelerating or decelerating effect on on individuals’ survival. Despite the survival functions of an AFT model never intersect as in the Cox model. However, having data with intersecting survival curves allows the data to be more complex and makes it more difficult for methods to predict survival. Besides, Cox and AFT models produce data with survival curves not crossing. To have crossing survival curves, we considered two approaches. The first approach consists of modifying the AFT model to have intersecting survival curves. The second approach concerns using an AH model to generate the survival data. The AH model is more flexible than the two models mentioned above. In the AH model, the variables will accelerate or decelerate the instantaneous risk of death. The survival curves of the AH model can therefore cross each other. This package also allows us to simulate survival data from modified AFT and AH models. The generation of survival times carries out from the different models mentioned above. The models’ baseline risk function of the models is assumed to be known and follows a specific probability distribution.</p>
<div id="reminder-of-the-functions-used-in-survival-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#reminder-of-the-functions-used-in-survival-analysis" class="anchor"></a>1.1 Reminder of the functions used in survival analysis</h2>
<p>The table below summarizes the writing of the functions used in survival analysis (instantaneous risk <span class="math inline">\(\lambda(t)\)</span>, cumulative risk function <span class="math inline">\(H_0(t)\)</span>, survival function <span class="math inline">\(S(t)\)</span> and density function <span class="math inline">\(f(t)\)</span>) for each of the models considered (Cox, AFT and AH models).</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="27%">
<col width="24%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">Cox model</th>
<th align="center">Accelerated failure Time model</th>
<th align="center">Accelerated hazard model</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math display">\[H(t\mid X_{i})\]</span></td>
<td align="center"><span class="math display">\[H_0(t)\exp(\beta^T X_{i})\]</span></td>
<td align="center"><span class="math display">\[H_0(t\exp(\beta^T X_{i}))\]</span></td>
<td align="center"><span class="math display">\[ H_0(t\exp(\beta^T X_{i}))\exp(-\beta^T X_{i})\]</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\lambda(t\mid X_{i})\)</span></td>
<td align="center"><span class="math display">\[\alpha_0(t)\exp(\beta^T X_{i})\]</span></td>
<td align="center"><span class="math display">\[\alpha_0(t\exp(\beta^T X_{i}))\exp(\beta^T X_{i})\]</span></td>
<td align="center"><span class="math display">\[\alpha_0(t\exp(\beta^T X_{i}))\]</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(S(t\mid X_{i})\)</span></td>
<td align="center"><span class="math display">\[S_0(t)^{\exp(\beta^T X_{i})}\]</span></td>
<td align="center"><span class="math display">\[S_0(t\exp(\beta^T X_{i}))\]</span></td>
<td align="center"><span class="math display">\[S_0(t\exp(\beta^T X_{i}))^{\exp(-\beta^T X_{i})}\]</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math display">\[f(t\mid X_{i})\]</span></td>
<td align="center"><span class="math display">\[f_0(t) \exp(\beta^T X_{i}) S_0(t)^{\exp(\beta^T X_{i})}\]</span></td>
<td align="center"><span class="math display">\[f_0(t\exp(\beta^T X_{i})) \exp(\beta^T X_{i})\]</span></td>
<td align="center"><span class="math display">\[f_0(t \exp(\beta^T X_{i})) S_0(t\exp(\beta^T X_{i}))^{(\exp(-\beta^T X_{i})-1)}\]</span></td>
</tr>
</tbody>
</table>
</div>
<div id="survival-times-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#survival-times-generation" class="anchor"></a>1.2 Survival times generation</h2>
<p>The models considered are composed of one function, <span class="math inline">\(\alpha_0(t)\)</span> the baseline risk and a parameter <span class="math inline">\(\beta,\)</span> reflecting the variables’ effect on survival times. For data generation, we assume that the baseline risk function <span class="math inline">\(\alpha_0(t)\)</span> is known and therefore follows a probability distribution. For this initial version of the package, the baseline hazard distributions are Weibull or log-normale. We summarize the characteristics of the distributions (Weibull/Log-normale) in the table below.</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="43%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">Weibull distribution</th>
<th align="center">Log-normal distribution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Parameters</td>
<td align="center">
<span class="math display">\[\lambda &gt; 0\]</span>  <span class="math display">\[a &gt; 0\]</span> </td>
<td align="center">
<span class="math display">\[\mu \in ]-\infty,+\infty[\]</span> <span class="math display">\[\sigma &gt; 0\]</span>
</td>
</tr>
<tr class="even">
<td align="center">Support</td>
<td align="center"><span class="math display">\[\mathbb{R}^+\]</span></td>
<td align="center"><span class="math display">\[\mathbb{R}^+_{\star}\]</span></td>
</tr>
<tr class="odd">
<td align="center">Baseline hazard</td>
<td align="center"><span class="math display">\[\alpha_0(t) = \lambda a t^{(a-1)}\]</span></td>
<td align="center"><span class="math display">\[\alpha_0(t) = \frac{\frac{1}{\sigma\sqrt{2\pi t}} \exp\left[-\frac{(\log t - \mu)^2 }{2 \sigma^2}\right]}{1 - \Phi\left[\frac{\log t - \mu}{\sigma}\right]}\]</span></td>
</tr>
<tr class="even">
<td align="center">Cumulative Hazard</td>
<td align="center"><span class="math display">\[H_0(t) = \lambda t^{a}\]</span></td>
<td align="center"><span class="math display">\[H_0(t) = - \log(1 - \Phi\left[\frac{\log t - \mu}{\sigma}\right])\]</span></td>
</tr>
<tr class="odd">
<td align="center">Inverse cumulative hazard</td>
<td align="center"><span class="math display">\[H_0^{-1}(u) = \left( \frac{u}{\lambda} \right)^{1/a}\]</span></td>
<td align="center"><span class="math display">\[H_0^{-1}(u) = \exp(\sigma\Phi^{-1}(1-\exp(-u))+\mu)\]</span></td>
</tr>
<tr class="even">
<td align="center">Density function</td>
<td align="center"><span class="math display">\[f(t) = \lambda a t^{(a-1)} \exp(-\lambda t^{a})\]</span></td>
<td align="center"><span class="math display">\[f(t) =  \exp\left[-\frac{(\log t - \mu)^2 }{2 \sigma^2}\right] \frac{1}{\sigma t \sqrt{2\pi }}\]</span></td>
</tr>
<tr class="odd">
<td align="center">Cumulative function</td>
<td align="center"><span class="math display">\[F(t) = \exp(-\lambda t^{a})\]</span></td>
<td align="center"><span class="math display">\[F(t) = 1 - \Phi\left[\frac{\log t - \mu}{\sigma}\right]\]</span></td>
</tr>
<tr class="even">
<td align="center">Expectation</td>
<td align="center"><span class="math display">\[\mathbb{E}(T) =  \Gamma(\frac{1}{a} + 1) \frac{1}{\sqrt[a\,]{\lambda}}\]</span></td>
<td align="center"><span class="math display">\[\mathbb{E}(T) = \exp (\mu + \frac{\sigma^2}{2})\]</span></td>
</tr>
<tr class="odd">
<td align="center">Variance</td>
<td align="center"><span class="math display">\[\mathbb{V}(T) =  \left[ \Gamma(\frac{2}{a} + 1) - \Gamma^2(\frac{1}{a} + 1)\right] \frac{1}{\sqrt[a\,]{\mu^2} }\]</span></td>
<td align="center"><span class="math display">\[ \mathbb{V}(T) = (\exp(\sigma^2) -1) \exp(2\mu+\sigma^2)\]</span></td>
</tr>
</tbody>
</table>
<p>with <span class="math inline">\(\Gamma\)</span> is the gamma function and <span class="math inline">\(\Phi\)</span> is the cumulative distribution function of the standard normal distribution.</p>
<p>The distribution function is deduced from the survival function from the following formula:</p>
<span class="math display">\[\begin{equation}
     F(t\mid X) = 1 - S(t\mid X). 
 \end{equation}\]</span>
For data generation, if <span class="math inline">\(Y\)</span> is a random variable that follows a probability distribution <span class="math inline">\(F,\)</span> then <span class="math inline">\(U = F(Y)\)</span> follows a uniform distribution over the interval <span class="math inline">\([0,1],\)</span> and <span class="math inline">\((1-U)\)</span> also follows a uniform distribution <span class="math inline">\(\mathcal{U}[0,1].\)</span> We finally obtain that:
<span class="math display">\[\begin{align}
     1 - U &amp;= S(t\mid X) \\ %\sim \mathcal{U} [0,1] \\
     &amp;= \exp(-H_0(\psi_1(X)t)\psi_2(X)) % \sim \mathcal{U} [0,1]. 
 \end{align}\]</span>
<!-- \label{eq:U} -->
<!-- %\textcolor{red}{equivalent do not put = ?} --> If <span class="math inline">\(\alpha_0(t)\)</span> is strictly positive for any <span class="math inline">\(t,\)</span> then <span class="math inline">\(H_0(t)\)</span> can be inverted and the survival time of each of the considered models (Cox, AFT, and AH) expresses for <span class="math inline">\(H_0^{-1}(u)\)</span>. The expression of the survival times for each of the models writes in a general way:
<span class="math display">\[\begin{equation}
      T = \frac{1}{\psi_1(X)} H^{-1}_0 \left( \frac{\log(1-U)}{\psi_2(X)} \right), \text{with}
  \end{equation}\]</span>
<span class="math display">\[\begin{equation}
(\psi_1(X), \psi_2(X)) = \left\{
    \begin{array}{ll}
        (1, \exp(\beta^TX)) &amp; \mbox{for the Cox model } \\
        (\exp(\beta^TX), \exp(-\beta^TX)) &amp; \mbox{for the AH model} \\\
        (\exp(\beta^TX), 1) &amp; \mbox{for the AFT model. } 
    \end{array}
\right.
\end{equation}\]</span>
<p>Two distributions are proposed for the cumulative risk function <span class="math inline">\(H_0(t)\)</span> to generate the survival data. If the survival times are distributed according to a Weibull distribution <span class="math inline">\(\mathcal{W}(a, \lambda),\)</span> the baseline risk is of the form: <!-- \footnote{We specify that the parameterization used for the Weibull distribution is the one used by \citet{http://zotero.org/users/local/uYsfYM7W/items/KP2R9YII}. --> <!-- }  --></p>
<span class="math display">\[\begin{equation}
    \alpha_0(t) = a\lambda t^{a-1}, \lambda &gt; 0, a &gt; 0.
\end{equation}\]</span>
The cumulative risk function is therefore written as follows:
<span class="math display">\[\begin{equation}
    H_0(t) = \lambda t^{a}, \lambda &gt; 0, a &gt; 0
\end{equation}\]</span>
and the inverse of this function is expressed as follows:
<span class="math display">\[\begin{equation}
     H_0^{-1}(u) = \left( \frac{u}{\lambda} \right)^{1/a}.
 \end{equation}\]</span>
In a second step, we considered that the survival times followed a log-normal <span class="math inline">\(\mathcal{LN}(\mu, \sigma)\)</span> distribution of mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>. The basic risk function is therefore written as:
<span class="math display">\[\begin{equation}
     \alpha_0(t) = \frac{\frac{\frac{1}{\sigma\sqrt{2\pi t}}} \exp\left[-\frac{(\log t - \mu)^2 }{2 \sigma^2}\right]}{1 - \Phi\left[\frac{\log t - \mu}{\sigma}\right]},
 \end{equation}\]</span>
with <span class="math inline">\(\Phi(t)\)</span> the distribution function of a centered and reduced normal distribution. The cumulative risk function is written as:
<span class="math display">\[\begin{equation}
     H_0(t) = - \log\left [1 - \Phi\left(\frac{\log t - \mu}{\sigma}\right)\right]
 \end{equation}\]</span>
and therefore the inverse of this function is expressed by:
<span class="math display">\[\begin{equation}
     H_0^{-1}(u) = \exp(\sigma\Phi^{-1}(1-\exp(-u))+\mu),
 \end{equation}\]</span>
<p>with <span class="math inline">\(\Phi^{-1}(t)\)</span> the inverse of the distribution function of a centered and reduced normal distribution.</p>
<p><!-- As specified in Section~\ref{sec:chap3_intro}, we have simulated the survival data from three different models. The first model considered is the Cox model whose baseline risk function distribution can be a Weibull or a log-normale distribution. This simulation allows us to have survival data by checking the proportional risks. --> <!-- Weibull's distribution shares the hypothesis of proportional risks with Cox's model. This is why we have associated it with the Cox model and why we have chosen another distribution for the AFT and AH models.  --> <!-- The second model considered for data simulation is the AFT model associated with the Weibull or log-normal distribution for the baseline risk function.  --> <!-- With the AFT model, the risks are not proportional. But the survival curves are parallel as for the Cox model. To have a more complex simulation with intersecting survival curves, simulated data can be simulated from a modified version of an AFT model. Data more complex can also be generated with an AH model whose baseline risk distribution can be the log-normal or Weibull distribution. --></p>
</div>
</div>
<div id="simulation-from-a-cox-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-from-a-cox-model" class="anchor"></a>2 Simulation from a Cox model</h1>
We used <span class="citation">(Bender, Augustin, and Blettner 2005)</span> to simulate the data from a Cox model. We have chosen to carry out this simulation to generate survival data that respects the proportional risk hypothesis. We generate survival data from a Cox model as follows:
<span class="math display">\[\begin{equation}
    T = H_0^{-1} \left[ \frac{-\log(1-U)}{\exp(\beta^T X_{i})}\right],
\end{equation}\]</span>
<p>where <span class="math inline">\(U \sim \mathcal{U} [0,1].\)</span></p>
<div id="simulation-from-a-cox-model-with-baseline-hazard-following-weibull-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-a-cox-model-with-baseline-hazard-following-weibull-distribution" class="anchor"></a>2.1 Simulation from a Cox model with baseline hazard following Weibull distribution</h2>
For this simulation, we consider that survival times follow a Weibull’s distribution <span class="math inline">\(\mathcal{W}(a,\lambda).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
    H_0(t) = - \log\left [1 - \Phi\left(\frac{\log t - \mu}{\sigma}\right)\right]
\end{equation}\]</span>
and survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \frac{1}{\lambda^{1/a}} \left( \frac{-\log(1-U)}{\exp(\beta^T X_{i})} \right)^{1/a} . 
    \end{equation}\]</span>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_paramW</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_param_weib.html">get_param_weib</a></span><span class="op">(</span>med <span class="op">=</span> <span class="fl">1062</span>, mu <span class="op">=</span> <span class="fl">1134</span><span class="op">)</span><span class="co">#compute_param_weibull(a_list = a_list, med = 2280, moy = 2325, var = 1619996)</span>
<span class="va">listCoxSim_n500_p1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelSim.html">modelSim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"cox"</span>, matDistr <span class="op">=</span> <span class="st">"unif"</span>, matParam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">500</span>, p <span class="op">=</span> <span class="fl">1000</span>, pnonull <span class="op">=</span> <span class="fl">20</span>, betaDistr <span class="op">=</span> <span class="fl">1</span>,
                                  hazDistr <span class="op">=</span> <span class="st">"weibull"</span>, hazParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">res_paramW</span><span class="op">$</span><span class="va">a</span>, <span class="va">res_paramW</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1</span>, d <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Warning in modelSim(model = "cox", matDistr = "unif", matParam = c(-1, 1), :</span>
<span class="co">#&gt; Options "non-linearity with interactions" not available</span>
<span class="co">#&gt; [1] 1.969765e+00 7.586963e-07</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">listCoxSim_n500_p1000</span><span class="op">)</span></code></pre></div>
<p><img src="How-to-simulate-survival-models_files/figure-html/sim_cox_model-1.png" width="700"></p>
</div>
<div id="simulation-from-a-cox-model-with-baseline-hazard-following-log-normale-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-a-cox-model-with-baseline-hazard-following-log-normale-distribution" class="anchor"></a>2.2 Simulation from a Cox model with baseline hazard following log-normale distribution</h2>
For this simulation, we consider that survival times follow a log-normal distribution <span class="math inline">\(\mathcal{LN}(a,\lambda).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
    H_0(t) = - \log\left [1 - \Phi\left(\frac{\log t - \mu}{\sigma}\right)\right]
\end{equation}\]</span>
and survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \exp\left(\sigma\Phi^{-1}(1-\exp\left(\frac{\log(1-U)}{\exp(\beta^TX_{i})}\right))+\mu\right). 
    \end{equation}\]</span>
</div>
</div>
<div id="simulation-from-the-aft-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-from-the-aft-model" class="anchor"></a>3 Simulation from the AFT model</h1>
To simulate the data from the AFT/Log-normal model, we used the procedure detailed in <span class="citation">(Leemis, Shih, and Reynertson 1990)</span>. We have chosen to perform this simulation in order to generate survival data that do not respect the proportional risk hypothesis. We generate the survival data from an AFT model as:
<span class="math display">\[\begin{equation}
    T = \frac{H_0^{-1} \left[ -\log(1-U)\right]}{\exp(\beta^T X_{i})},
\end{equation}\]</span>
<p>where <span class="math inline">\(U \sim \mathcal{U} [0,1].\)</span></p>
<div id="simulation-from-the-aft-model-with-baseline-hazard-following-weibull-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-aft-model-with-baseline-hazard-following-weibull-distribution" class="anchor"></a>3.1 Simulation from the AFT model with baseline hazard following Weibull distribution</h2>
For this simulation, we consider that survival times follow a log-normal distribution <span class="math inline">\(\mathcal{W}(a,\lambda).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
     H_0(t) = \lambda t^{a}.
\end{equation}\]</span>
<!-- where $\Phi(t)$ is the distribution function of the centred and reduced normal distribution.  -->
Survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \left( \frac{-\log(1-U)}{\lambda}\right)^{\frac{1}{a}} \exp(-\beta^T X_{i}). 
\end{equation}\]</span>
</div>
<div id="simulation-from-the-aft-model-with-baseline-hazard-following-log-normale-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-aft-model-with-baseline-hazard-following-log-normale-distribution" class="anchor"></a>3.2 Simulation from the AFT model with baseline hazard following log-normale distribution</h2>
For this simulation, we consider that survival times follow a log-normal distribution <span class="math inline">\(\mathcal{LN}(\mu,\sigma).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
     H_0(t) = - \log\left [1 - \Phi\left(\frac{\log t - \mu}{\sigma}\right)\right],
\end{equation}\]</span>
where <span class="math inline">\(\Phi(t)\)</span> is the distribution function of the centred and reduced normal distribution. Survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \frac{1}{\exp(\beta^T X_{i})} \exp(\sigma \phi^{-1}(U) + \mu). 
\end{equation}\]</span>
<!-- \label{eq:Taft}  -->
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">listAFTSim_n500_p1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelSim.html">modelSim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"AFT"</span>, matDistr <span class="op">=</span> <span class="st">"unif"</span>, matParam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">500</span>, p <span class="op">=</span> <span class="fl">100</span>, pnonull <span class="op">=</span> <span class="fl">100</span>, 
                                  betaDistr <span class="op">=</span> <span class="fl">1</span>, hazDistr <span class="op">=</span> <span class="st">"log-normal"</span>, hazParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0</span><span class="op">)</span>, Phi <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">1</span>, d <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Warning in modelSim(model = "AFT", matDistr = "unif", matParam = c(-1, 1), :</span>
<span class="co">#&gt; Options "non-linearity with interactions" not available</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">listAFTSim_n500_p1000</span><span class="op">)</span></code></pre></div>
<p><img src="How-to-simulate-survival-models_files/figure-html/sim_aft_model-1.png" width="700"></p>
</div>
</div>
<div id="simulation-from-the-shifted-aft-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-from-the-shifted-aft-model" class="anchor"></a>4 Simulation from the shifted AFT model</h1>
As mentioned above, we simulated survival data from a modified AFT model to obtain intersecting survival curves. We rewrite the cumulative risk function by adding a term <span class="math inline">\(\phi_2(X)\)</span>:
<span class="math display">\[\begin{equation}
   H(t|X) = H_0(t\exp(\beta^T X_{i}) + \phi_2(X)),
\end{equation}\]</span>
with <span class="math inline">\(\phi_2(X) = -\beta_2^T X_{i}.\)</span> We get:
<span class="math display">\[\begin{equation}
     1 - U = \exp(-H_0(t\exp(\beta^T X_{i})) - \beta_2^T X_{i}) \sim \mathcal{U} [0,1]
 \end{equation}\]</span>
because <span class="math inline">\(U \sim \mathcal{U} [0,1].\)</span> If <span class="math inline">\(\alpha_0(t)\)</span> is strictly positive for any <span class="math inline">\(t,\)</span> then <span class="math inline">\(H_0(t)\)</span> can be inverted and the survival time can be expressed from <span class="math inline">\(H_0^{-1}(u)\)</span>:
<span class="math display">\[\begin{equation}
      T = \frac{1}{\exp(\beta^T X_{i})} \left [H^{-1}_0 \left(-\log(1-U) \right) +\beta_2^T X_{i} \right].
  \end{equation}\]</span>
<div id="simulation-from-the-shifted-aft-model-with-baseline-hazard-following-weibull-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-shifted-aft-model-with-baseline-hazard-following-weibull-distribution" class="anchor"></a>4.1 Simulation from the shifted AFT model with baseline hazard following Weibull distribution</h2>
Moreover, we suppose that the survival times follow a Weibull distribution and the inverse of the cumulative risk function is then written <span class="math inline">\(H_0^{-1}(u) = \left(\frac{u}{\lambda}\right)^{\frac{1}{a}}\)</span>. <!-- with $\Phi^{-1}(t)$ the inverse of the distribution function of a centered and reduced normal distribution. --> We generate thus the survival times as follows:
<span class="math display">\[\begin{equation}
    T = \left( \left( \frac{-\log(1-U)}{\lambda} \right)^{\frac{1}{a}} + \beta_2^T X_{i} \right) \exp(-\beta^T X_{i}). 
\end{equation}\]</span>
<p>with <span class="math inline">\(U \sim \mathcal{U} [0,1].\)</span></p>
</div>
<div id="simulation-from-the-shifted-aft-model-with-baseline-hazard-following-log-normale-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-shifted-aft-model-with-baseline-hazard-following-log-normale-distribution" class="anchor"></a>4.2 Simulation from the shifted AFT model with baseline hazard following log-normale distribution</h2>
Moreover, we suppose that the survival times follow a log-normal distribution and the inverse of the cumulative risk function is then written <span class="math inline">\(H_0^{-1}(u) = \exp(\sigma\Phi^{-1}(1-\exp(-u))+\mu)\)</span> with <span class="math inline">\(\Phi^{-1}(t)\)</span> the inverse of the distribution function of a centered and reduced normal distribution. We generate thus the survival times as follows:
<span class="math display">\[\begin{equation}
T = \frac{1}{\exp(\beta^T X_{i})} \left( \exp(\sigma \Phi^{-1}(U) + \mu) + \beta_2^T X_{i} \right), 
\end{equation}\]</span>
<p>with <span class="math inline">\(U \sim \mathcal{U} [0,1].\)</span></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># res_paramLN = get_param_ln(var = 600000, mu = 1134)#compute_param_weibull(a_list = a_list, med = 2280, moy = 2325, var = 1619996)</span>
<span class="va">listAFTsSim_n500_p1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelSim.html">modelSim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"AFTshift"</span>, matDistr <span class="op">=</span> <span class="st">"unif"</span>, matParam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">500</span>, 
                                   p <span class="op">=</span> <span class="fl">100</span>, pnonull <span class="op">=</span> <span class="fl">100</span>, betaDistr <span class="op">=</span> <span class="st">"unif"</span>, hazDistr <span class="op">=</span> <span class="st">"log-normal"</span>, 
                                   hazParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">7.8</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1</span>, d <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Warning in modelSim(model = "AFTshift", matDistr = "unif", matParam = c(-1, :</span>
<span class="co">#&gt; Options "non-linearity with interactions" not available</span>
<span class="co">#&gt; Warning in log(mat_grille_ti * (1/as.vector(eta_i)) - matrix(phi2, nrow(Z), :</span>
<span class="co">#&gt; production de NaN</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">listAFTsSim_n500_p1000</span><span class="op">)</span></code></pre></div>
<p><img src="How-to-simulate-survival-models_files/figure-html/sim_aft_mod_model-1.png" width="700"></p>
</div>
</div>
<div id="simulation-from-a-ah-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-from-a-ah-model" class="anchor"></a>5 Simulation from a AH model</h1>
Building on the work of <span class="citation">(Bender, Augustin, and Blettner 2005, <span class="citation">Leemis, Shih, and Reynertson (1990)</span>)</span>, we also simulated survival data from another model, the AH model. We performed this simulation to generate data with intersecting survival curves. We generate the survival data from an AH model as:
<span class="math display">\[\begin{equation}
    T = \frac{1}{\exp(\beta^T X_{i})} H_0^{-1} \left[ -\frac{\log(1-U)}{\exp(-\beta^T X_{i})}\right],
\end{equation}\]</span>
<p>with <span class="math inline">\(U \sim \mathcal{U}([0,1])\)</span></p>
<div id="simulation-from-the-ah-model-with-baseline-hazard-following-weibull-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-ah-model-with-baseline-hazard-following-weibull-distribution" class="anchor"></a>5.1 Simulation from the AH model with baseline hazard following Weibull distribution</h2>
For this simulation, we consider that survival times follow a log-normal distribution <span class="math inline">\(\mathcal{W}(a,\lambda).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
     H_0(t) = \lambda t^{a},
\end{equation}\]</span>
where <span class="math inline">\(\Phi(t)\)</span> is the distribution function of the centred and reduced normal distribution. Survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \left( \frac{-\log(1-U) \exp(\beta^T X_{i})}{\lambda}\right)^{\frac{1}{a}} \exp(-\beta^T X_{i}). 
\end{equation}\]</span>
</div>
<div id="simulation-from-the-ah-model-with-baseline-hazard-following-log-normale-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-the-ah-model-with-baseline-hazard-following-log-normale-distribution" class="anchor"></a>5.2 Simulation from the AH model with baseline hazard following log-normale distribution</h2>
For this simulation, we consider that survival times follow a log-normal distribution <span class="math inline">\(\mathcal{LN}(\mu,\sigma).\)</span> In this case, we have the cumulative risk function expressed by:
<span class="math display">\[\begin{equation}
     H_0(t) = - \log\left [1 - \Phi\left(\frac{\log t - \mu}{\sigma}\right)\right],
\end{equation}\]</span>
where <span class="math inline">\(\Phi(t)\)</span> is the distribution function of the centred and reduced normal distribution. Survival times can therefore be simulated from:
<span class="math display">\[\begin{equation}
    T = \frac{1}{\exp(\beta^T X_{i})} \exp\left[\sigma \Phi^{-1}\left(\frac{\log(1-U)}{\exp(-\beta^T X_{i})} \right) + \mu\right] 
\end{equation}\]</span>
<!-- \label{eq:Tah} -->
<p>with <span class="math inline">\(\Phi^{-1}(t)\)</span> the inverse of the distribution function of a centered and reduced normal distribution.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_paramLN</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_param_ln.html">get_param_ln</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fl">600000</span>, mu <span class="op">=</span> <span class="fl">1134</span><span class="op">)</span><span class="co">#compute_param_weibull(a_list = a_list, med = 2280, moy = 2325, var = 1619996)</span>
<span class="va">listAHSim_n500_p1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelSim.html">modelSim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"AH"</span>, matDistr <span class="op">=</span> <span class="st">"unif"</span>, matParam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">500</span>, p <span class="op">=</span> <span class="fl">100</span>, 
                                 pnonull <span class="op">=</span> <span class="fl">100</span>, betaDistr <span class="op">=</span> <span class="fl">1</span>, hazDistr <span class="op">=</span> <span class="st">"log-normal"</span>, 
                                 hazParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1</span>, d <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Warning in modelSim(model = "AH", matDistr = "unif", matParam = c(-1, 1), :</span>
<span class="co">#&gt; Options "non-linearity with interactions" not available</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">listAHSim_n500_p1000</span><span class="op">)</span></code></pre></div>
<p><img src="How-to-simulate-survival-models_files/figure-html/sim_ah_model-1.png" width="700"></p>
</div>
</div>
<div id="perspectives" class="section level1">
<h1 class="hasAnchor">
<a href="#perspectives" class="anchor"></a>6 Perspectives</h1>
<p>We planned several perspectives for the package as adding interactions and non-linear effects by proposing complex functions and considering other baseline risk distributions.</p>
<div id="interactions-and-non-linear-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#interactions-and-non-linear-effects" class="anchor"></a>6.1 Interactions and non-linear effects</h2>
<p>Note that we have remained in a linear dependency framework with no interaction. The second version will take into account the non-linear and interaction framework by replacing <span class="math inline">\(\beta^T X\)</span> with a more complex <span class="math inline">\(g(X)\)</span> dependency.</p>
</div>
<div id="other-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#other-distributions" class="anchor"></a>6.2 Other distributions</h2>
<p>We can already simulate data for the Cox model by considering Gompertz or exponential distributions for the baseline risk. The perspective is to propose also these distributions for the baseline hazard in the AFT and AH models. We wish to suggest other distributions as gamma and log-logistic distributions.</p>
<!-- # Utils functions -->
<!-- The package enables simulating data close to real datasets. In this goal, we have to know the mean, median, and variance of real datasets and then compute the parameters of the used distribution to have a similar distribution of survival times by giving the mean, median, and variance. -->
<!-- ## Get parameters of survival time distribution  -->
<!-- ```{r param_distr} -->
<!-- # Weibull distribution -->
<!-- res_paramW = get_param_weib(med = 1062, mu = 1134) -->
<!-- res_paramW -->
<!-- # Log-normale distribution -->
<!-- res_paramLN = get_param_ln(var = 600000, mu = 1134) -->
<!-- res_paramLN -->
<!-- ``` -->
<!-- ## Plotting survival curves -->
<!-- # ```{r surv_curves} -->
<!-- # ## Cox/Weibull model -->
<!-- # # df_p1000_n500[1:6,1:10] -->
<!-- # surv_fct_cox_p1m = compute_surv_fct_cox(Z = listCoxSim_n500_p1000$Z, TC = listCoxSim_n500_p1000, delta = listCoxSim_n500_p1000$delta, -->
<!-- #                      hazDistr = "weibull", hazParams = c(res_paramW$a, res_paramW$lambda), beta = c(rep(1/sqrt(20), 20), -->
<!-- #                                                                                                     rep(0, ncol(listCoxSim_n500_p1000$Z)-20))) -->
<!-- # surv_fct_cox_p1m$plot -->
<!-- # # surv_fct_aft_p1m = compute_surv_fct_aft(Z = listAFTSim_n500_p1000$Z, TC = listAFTSim_n500_p1000, delta = listAFTSim_n500_p1000$delta, -->
<!-- # #                      hazDistr = "log-normal", hazParams = c(res_paramLN$a, res_paramLN$lambda), Phi = "shift", -->
<!-- # #                      beta = c(rep(1/sqrt(20), 20), rep(0, ncol(listAFTSim_n500_p1000$Z)-20))) -->
<!-- # # surv_fct_aft_p1m$plot -->
<!-- # ``` -->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-http://zotero-org/users/local/uYsfYM7W/items/KP2R9YII">
<p>Bender, Ralf, Thomas Augustin, and Maria Blettner. 2005. “Generating Survival Times to Simulate Cox Proportional Hazards Models.” <em>Statistics in Medicine</em> 24 (11): 1713–23. doi:<a href="https://doi.org/10.1002/sim.2059">10.1002/sim.2059</a>.</p>
</div>
<div id="ref-http://zotero-org/users/local/uYsfYM7W/items/4NPJ6PV4">
<p>Chen, Ying Qing, and Mei-Cheng Wang. 2000. “Analysis of Accelerated Hazards Models.” <em>Journal of the American Statistical Association</em> 95 (450): 608–18. doi:<a href="https://doi.org/10.1080/01621459.2000.10474236">10.1080/01621459.2000.10474236</a>.</p>
</div>
<div id="ref-http://zotero-org/users/local/uYsfYM7W/items/NN8SEC4E">
<p>Cox, D. R. 1972. “Regression Models and Life-Tables.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 34 (2): 187–220.</p>
</div>
<div id="ref-http://zotero-org/users/local/uYsfYM7W/items/KCILGW99">
<p>Leemis, Lawrence M., Li-Hsing Shih, and Kurt Reynertson. 1990. “Variate Generation for Accelerated Life and Proportional Hazards Models with Time Dependent Covariates.” <em>Statistics &amp; Probability Letters</em> 10 (4): 335–39. doi:<a href="https://doi.org/10.1016/0167-7152(90)90052-9">10.1016/0167-7152(90)90052-9</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mathildesautreuil.github.io/">Mathilde Sautreuil</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
